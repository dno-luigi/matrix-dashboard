<!DOCTYPE html>
<html>
<head>
    <title>üß© Matrix AI - File Upload + Chat</title>
    <style>*{margin:0;padding:0;box-sizing:border-box}body{background:linear-gradient(135deg,#0f0f23,#1a1a3e);color:#e2e2e2;font-family:sans-serif;padding:20px;min-height:100vh}.dashboard{max-width:900px;margin:0 auto}header{text-align:center;padding:40px 20px;background:rgba(255,255,255,0.1);border-radius:20px;margin-bottom:30px}h1{font-size:2.5rem;color:#4ade80}.tabs{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:20px}.tab{flex:1;padding:15px;background:rgba(255,255,255,0.1);border:none;color:white;border-radius:10px;cursor:pointer;font-size:14px}.tab.active{background:#4ade80;color:black}.tab-content{display:none;background:rgba(255,255,255,0.05);padding:25px;border-radius:15px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.1)}.tab-content.active{display:block}textarea,input{width:100%;padding:15px;background:rgba(0,0,0,0.5);border:1px solid #4ade80;border-radius:10px;color:white;font-family:monospace;font-size:14px;margin-bottom:15px;box-sizing:border-box}textarea{height:200px;resize:vertical}button{padding:12px 20px;background:#4ade80;color:black;border:none;border-radius:10px;cursor:pointer;margin:5px;font-weight:bold;transition:all .3s}button:hover{transform:scale(1.05);box-shadow:0 5px 15px rgba(74,222,128,.4)}.button-row{display:flex;flex-wrap:wrap;gap:10px}.status{padding:15px;background:rgba(0,0,0,0.4);border-radius:10px;font-size:14px}.output{background:rgba(74,222,128,0.2);padding:15px;border-radius:10px;border-left:4px solid #4ade80;margin-top:10px;white-space:pre-wrap;font-family:monospace;max-height:300px;overflow:auto}.error{background:rgba(239,68,68,0.2);border-left-color:#ef4444;color:#ef4444}.file-upload{display:flex;flex-direction:column;gap:15px}.file-input-wrapper{position:relative;display:inline-block;width:100%}.file-input-wrapper input[type=file]{position:absolute;opacity:0;width:100%;height:100%;cursor:pointer}.file-label{display:inline-block;padding:15px;background:rgba(74,222,128,0.2);border:2px dashed #4ade80;border-radius:10px;text-align:center;cursor:pointer;width:100%;transition:all .3s}.file-label:hover{background:rgba(74,222,128,0.4)}.file-info{margin-top:10px;padding:10px;background:rgba(0,0,0,0.3);border-radius:8px;font-family:monospace;font-size:12px;max-height:100px;overflow:auto}@media(max-width:600px){.tabs{flex-direction:column}.tab{flex:none}}</style>
</head>
<body>
    <div class="dashboard">
        <header><h1>üß© Matrix AI Code Assist</h1><p>üìÅ File Upload + AI Chat + Infinite Context</p></header>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('upload')">üìÅ Upload</button>
            <button class="tab" onclick="showTab('ai')">ü§ñ AI Chat</button>
            <button class="tab" onclick="showTab('context')">üß† Context</button>
            <button class="tab" onclick="showTab('sandbox')">üêç Sandbox</button>
        </div>

        <!-- FILE UPLOAD TAB -->
        <div id="upload" class="tab-content active">
            <h3>üìÅ Upload Codebase/Project Files</h3>
            <div class="file-upload">
                <div class="file-input-wrapper">
                    <input type="file" id="file-input" multiple accept=".js,.ts,.py,.html,.css,.json,.txt,.md">
                    <label for="file-input" class="file-label">üìÅ Click to upload files<br><small>Supports JS, Python, HTML, CSS, JSON, TXT, MD</small></label>
                </div>
                <div id="file-list" class="file-info">No files selected</div>
                <button onclick="uploadFiles()">üíæ Save to Session Memory</button>
            </div>
            <div id="upload-status" class="output">Ready to upload...</div>
        </div>

        <!-- AI CHAT TAB -->
        <div id="ai" class="tab-content">
            <input id="ai-input" placeholder="Ask about your uploaded code: 'refactor auth', 'add login'...">
            <div class="button-row">
                <button onclick="chatAI()">üí¨ Ask Matrix AI</button>
                <button onclick="testAI()">üß™ Test Connection</button>
            </div>
            <div id="ai-output" class="output">AI ready! Upload files first for context-aware responses</div>
        </div>

        <!-- CONTEXT TAB -->
        <div id="context" class="tab-content">
            <textarea id="context-text" placeholder="Current context will appear here..."></textarea>
            <div class="button-row">
                <button onclick="loadContext()">üìÇ Load Context</button>
                <button onclick="clearContext()">üóëÔ∏è Clear All</button>
            </div>
            <div id="context-status" class="output">No context loaded (0 chars)</div>
        </div>

        <!-- SANDBOX TAB -->
        <div id="sandbox" class="tab-content">
            <textarea id="py-code">print("Hello from Matrix Sandbox!")
print("Your context is available to AI!")</textarea>
            <button onclick="runSandbox()">üêç Run Python</button>
            <div id="sandbox-output" class="output">Click Run Python to test sandbox</div>
        </div>

        <div class="status">
            Session: <strong id="session-id">matrix-demo</strong> | 
            Files: <strong id="file-count">0</strong> | 
            Context: <strong id="context-size">0 chars</strong>
        </div>
    </div>
    <script>
let sessionId = 'matrix-' + Date.now();
let uploadedFiles = [];
let currentTab = 'upload';

const MATRIX_URL = 'https://matrix.ai-n.workers.dev';
const SESSION_URL = 'https://session.ai-n.workers.dev';

function showTab(tab) {
    document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById(tab).classList.add('active');
    currentTab = tab;
}

document.getElementById('file-input').addEventListener('change', function(e) {
    uploadedFiles = Array.from(e.target.files);
    let fileList = uploadedFiles.map(f => `${f.name} (${(f.size/1024).toFixed(1)}KB)`).join('\n');
    document.getElementById('file-list').textContent = uploadedFiles.length ? 
        `Selected ${uploadedFiles.length} files:\n${fileList}` : 'No files selected';
    document.getElementById('file-count').textContent = uploadedFiles.length;
});

async function uploadFiles() {
    if (!uploadedFiles.length) {
        document.getElementById('upload-status').innerHTML = '<span class="error">No files selected!</span>';
        return;
    }
    
    document.getElementById('upload-status').textContent = 'üìÅ Uploading to Session Memory...';
    
    let context = '';
    for (let file of uploadedFiles) {
        const text = await file.text();
        context += `\n\n--- ${file.name} (${(file.size/1024).toFixed(1)}KB) ---\n${text}`;
    }
    
    try {
        const response = await fetch(`${SESSION_URL}/session/context`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                sessionId, 
                context: {codebase: context, files: uploadedFiles.length, uploadedAt: new Date().toISOString()}
            })
        });
        
        const data = await response.json();
        document.getElementById('upload-status').innerHTML = `‚úÖ <strong>${uploadedFiles.length} files</strong> (${context.length} chars) saved to Infinite Memory!`;
        document.getElementById('context-size').textContent = `${context.length} chars`;
        document.getElementById('file-count').textContent = uploadedFiles.length;
    } catch(e) {
        document.getElementById('upload-status').innerHTML = `<span class="error">‚ùå Upload failed: ${e.message}</span>`;
    }
}

async function chatAI() {
    const prompt = document.getElementById('ai-input').value;
    if (!prompt) return;
    
    const output = document.getElementById('ai-output');
    output.innerHTML = 'ü§ñ Asking Matrix AI...';
    
    try {
        const response = await fetch(`${MATRIX_URL}/ai/chat`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({message: prompt, sessionId})
        });
        
        const data = await response.json();
        output.innerHTML = `ü§ñ Matrix AI:<br><strong>${data.response || data.fallbackResponse}</strong><br><br>üìä Model: ${data.modelInfo?.usedModel || 'Matrix'}`;
    } catch(e) {
        output.innerHTML = `<span class="error">‚ùå AI Error: ${e.message}</span>`;
    }
}

async function testAI() {
    document.getElementById('ai-output').innerHTML = 'üß™ Testing AI connection...';
    try {
        const response = await fetch(`${MATRIX_URL}/ai/chat`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({message: 'test connection', sessionId})
        });
        document.getElementById('ai-output').textContent = '‚úÖ AI connection WORKING!';
    } catch(e) {
        document.getElementById('ai-output').innerHTML = `<span class="error">‚ùå AI connection failed</span>`;
    }
}

async function loadContext() {
    document.getElementById('context-status').textContent = 'üìÇ Loading context...';
    try {
        const response = await fetch(`${SESSION_URL}/session/context?sessionId=${sessionId}`);
        const data = await response.json();
        const context = data.infiniteContext?.codebase || '';
        document.getElementById('context-text').value = context;
        document.getElementById('context-size').textContent = `${data.totalContextSize || 0} chars`;
        document.getElementById('context-status').innerHTML = `‚úÖ Loaded <strong>${context.length} chars</strong> from Session Memory!`;
    } catch(e) {
        document.getElementById('context-status').innerHTML = `<span class="error">‚ùå Load failed: ${e.message}</span>`;
    }
}

async function clearContext() {
    if (!confirm('Clear ALL session memory?')) return;
    document.getElementById('context-status').textContent = 'üóëÔ∏è Clearing...';
    try {
        await fetch(`${SESSION_URL}/session/context`, {
            method: 'DELETE',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({sessionId})
        });
        document.getElementById('context-text').value = '';
        document.getElementById('context-size').textContent = '0 chars';
        document.getElementById('context-status').textContent = '‚úÖ Memory cleared!';
    } catch(e) {
        document.getElementById('context-status').innerHTML = `<span class="error">‚ùå Clear failed</span>`;
    }
}

async function runSandbox() {
    const code = document.getElementById('py-code').value;
    document.getElementById('sandbox-output').textContent = 'üêç Running in Matrix Sandbox...';
    
    try {
        const response = await fetch(`${MATRIX_URL}/run?code=${encodeURIComponent(code)}&sessionId=${sessionId}`);
        const data = await response.json();
        document.getElementById('sandbox-output').innerHTML = 
            `üêç Output:\n${data.output || 'No output'}\n\n‚ùå Error: ${data.error || 'None'}\n‚úÖ Success: ${data.success ? 'Yes' : 'No'}`;
    } catch(e) {
        document.getElementById('sandbox-output').innerHTML = `<span class="error">‚ùå Sandbox failed: ${e.message}</span>`;
    }
}

document.getElementById('session-id').textContent = sessionId;
    </script>
</body>
</html>